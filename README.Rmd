---
output: github_document
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 6,
  dpi = 150
)
```

# almmr – Archaeological Landscape Movement Modeling in R

The **almmr** package provides tools for modeling movement, accessibility, and territorial structure in archaeological landscapes.  
It builds on digital elevation models (DEMs) and implements cost-surface modeling, least-cost path analysis (TPLA), and spatial boundary reconstruction (SBR) methods.  
All examples below use a 25 m DEM of the Heuneburg region in Baden-Württemberg, Germany, included with the package.

---

## Installation

```r
# Install from GitHub
devtools::install_github("j-abele/almmr")

library(almmr)
library(terra)
library(raster)
library(sf)
```

---

## First step – Cost Surface Generation

```r
# Load DEM and create hillshade
data(dem)
r <- dem()
hs <- almmr::create_hillshade(dem)

# Create cost surface using Tobler's Hiking Function
cs <- almmr::create_cost_surface(
  dem = r,
  costFunction = "ToblersHikingFunction"
)

# Plot cost surface on hillshade
plot(hs, col = gray.colors(256, 0.1, 1), legend = FALSE, main = "Cost Surface (Tobler)")
plot(raster::raster(cs), add = TRUE, alpha = 0.5)
```

---

## TPLA (Least-Cost Path Analysis)

```r
# Generate random start and end points within the DEM extent
set.seed(42)
pts <- sf::st_sample(sf::st_as_sf(terra::as.polygons(r)), 2)
names(pts) <- c("start", "end")

# Compute least-cost path
path <- almmr::perform_tpla_line_based(
  cost_surface = cs,
  start_point = pts[1],
  end_point = pts[2]
)

# Plot path on hillshade
plot(hs, col = gray.colors(256, 0.1, 1), legend = FALSE, main = "Least-Cost Path (TPLA)")
plot(path, col = "red", lwd = 2, add = TRUE)
plot(pts, col = c("blue", "darkgreen"), pch = 16, add = TRUE)
legend("topleft", legend = c("Start", "End", "Least-cost path"),
       col = c("blue", "darkgreen", "red"), lty = c(NA, NA, 1),
       pch = c(16, 16, NA), bg = "white")
```

---

## LCSC Territory - Potential settlement area

```r
# Create 10 random settlement points
set.seed(7)
points_sf <- sf::st_sample(sf::st_as_sf(terra::as.polygons(r)), 10)

# Run LCSC territory clustering
territories <- lcsc_territory(
  points_sf,
  dem = r,
  epsg = "EPSG:25832"
)

# Plot territories on hillshade
plot(hs, col = gray.colors(256, 0.1, 1), legend = FALSE, main = "LCSC Territories (n = 10)")
plot(territories, col = hcl.colors(10, "Spectral", alpha = 0.5), add = TRUE)
plot(points_sf, col = "black", pch = 16, add = TRUE)
```

---

## SBR_network - Site-based (theoretical) route network (sbr_network)

```r
# Create 20 random points in the DEM extent
set.seed(9)
network_pts <- sf::st_sample(sf::st_as_sf(terra::as.polygons(r)), 20)

# Build spatial boundary reconstruction (SBR) network
sbr_net <- sbr_network(
  points = network_pts,
  cost_surface = cs
)

# Select two random nodes for shortest path visualization
nodes <- sample(1:length(network_pts), 2)
sp <- sbr_shortest_path(
  sbr_net,
  from = nodes[1],
  to = nodes[2]
)

# Plot network and shortest path on hillshade
plot(hs, col = gray.colors(256, 0.1, 1), legend = FALSE, main = "SBR Network and Shortest Path")
plot(sbr_net, col = "darkgray", add = TRUE)
plot(sp, col = "red", lwd = 2, add = TRUE)
plot(network_pts, col = "black", pch = 16, add = TRUE)
```

---

## License

Code licensed under the MIT License.  
Example data (Heuneburg DEM) © LGL Baden-Württemberg, used with permission.

